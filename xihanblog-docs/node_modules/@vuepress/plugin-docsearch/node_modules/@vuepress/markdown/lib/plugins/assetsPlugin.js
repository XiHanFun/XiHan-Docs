"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.assetsPlugin = void 0;
const shared_1 = require("@vuepress/shared");
const utils_1 = require("@vuepress/utils");
/**
 * Plugin to handle assets links
 */
const assetsPlugin = (md, { relativePathPrefix = '@source' } = {}) => {
    const rawRule = md.renderer.rules.image;
    md.renderer.rules.image = (tokens, idx, options, env, self) => {
        const token = tokens[idx];
        // get the image link
        const link = token.attrGet('src');
        // if the link is relative path, and the `env.filePathRelative` exists
        if (link && !shared_1.isLinkAbsolute(link) && env.filePathRelative) {
            // add `@source` alias to the link
            const resolvedLink = utils_1.path.join(relativePathPrefix, utils_1.path.dirname(env.filePathRelative), link);
            // replace the original link with absolute path
            token.attrSet('src', resolvedLink);
        }
        return rawRule(tokens, idx, options, env, self);
    };
};
exports.assetsPlugin = assetsPlugin;
//# sourceMappingURL=assetsPlugin.js.map